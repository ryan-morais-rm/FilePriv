<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <title>FilePriv - Página Inicial</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="../css/homepage.css">
</head>
<body>

  <!-- Navbar -->
  <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm">
    <div class="container-fluid container">
      <img src="../../../assets/FilePriv Logo.jpg" alt="FilePriv Logo" class="navbar-logo-img">
      
      <a class="navbar-brand font-weight-bold text-primary" href="#"><strong>FilePriv</strong></a>
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarTop">
        <span class="navbar-toggler-icon"></span>
      </button>

      <div class="collapse navbar-collapse" id="navbarTop">
        <ul class="navbar-nav me-auto">
          <li class="nav-item active"><a class="nav-link text-dark" href="index.html">Índice</a></li>
          <li class="nav-item"><a class="nav-link text-dark" href="support.html">Suporte</a></li>
          <li class="nav-item dropdown">
            <a class="nav-link dropdown-toggle text-dark" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown">Opções</a>
            <div class="dropdown-menu">
              <a class="dropdown-item" href="pushFile.html">Enviar Arquivo</a>
              <a class="dropdown-item" href="pullFile.html">Baixar Arquivo</a>
              <a class="dropdown-item" href="servers.html">Gerenciar servidores</a>
            </div>
          </li>
        </ul>
      </div>
    </div>
  </nav>

  <!-- Conteúdo Principal -->
  <div class="container content-section">
    <h2 class="mb-4 text-center text-secondary"> <strong>Dashboard principal</strong></h2>
    <div class="row mb-4">
      
      <!-- Informação de Usuário e Redefinir Atributos -->
      <div class="col-md-6">
        <div class="info-card">
          <h4 class="mb-3"><strong>Informação do Usuário</strong></h4>
          <div id="userInfoDisplay">
            <p><strong>Nome:</strong> <span id="display-name"></span></p>
            <p><strong>Email:</strong> <span id="display-email"></span></p>
            <p><strong>Estado:</strong> <span id="display-state"></span></p>
            <p><strong>Telefone:</strong> <span id="display-phone"></span></p>
            <p class="mb-3"><strong>Instituição:</strong> <span id="display-institution"></span></p>
          </div>
          
          <button class="btn btn-primary mt-3 w-100 fw-bold" data-bs-toggle="modal" data-bs-target="#updateAttributesModal">
            Redefinir Atributos
          </button>
        </div>
      </div>

      <!-- Informação dos Servidores e Gerenciamento -->
      <div class="col-md-6">
        <div class="info-card">
          <h4 class="mb-3"><strong>Informação dos Servidores</strong></h4>
          
          <div id="serverListContainer" class="mb-3">
              <!-- Servidores serão injetados aqui -->
          </div>
          
          <button class="btn btn-primary mt-3 w-100 fw-bold" data-bs-toggle="modal" data-bs-target="#manageServersModal">
            Configuração resumida
          </button>
        </div>
      </div>
    </div>

    <!-- Seção da Topologia Interativa (Substitui a imagem estática) -->
    <div class="row">
      <div class="col-12 text-center topology-container">
        <h4 class="mt-4 mb-3">Topologia da Rede Distribuída (Interativa)</h4>
        
        <div class="topology-map">
            <!-- Linha de Conexão: Usuário -> Aplicação --><div class="connection-line line-user-app"></div>

            <!-- Nó de Usuário --><div class="node user" onclick="showUserDetails()">
                <i class="fas fa-user-circle"></i>
                <span>Usuário</span>
            </div>

            <!-- Linha de Conexão: Aplicação -> Servidores --><div class="connection-line line-app-servers"></div>

            <!-- Nó de Aplicação --><div class="node application" onclick="showApplicationDetails()">
                <i class="fas fa-server"></i>
                <span>Aplicação FilePriv (Máquina local)
                </span>
            </div>

            <!-- Grupo de Nós de Servidor --><div class="server-nodes" id="serverNodesContainer">
                <!-- Servidores serão injetados aqui via JS --></div>
            
            <!-- Card de Detalhes do Servidor (posicionamento dinâmico) --><div class="server-details" id="serverDetailsCard">
                <button type="button" class="btn-close btn-sm position-absolute top-0 end-0 m-2" aria-label="Fechar" onclick="hideServerDetails()"></button>
                <h6 id="detail-server-name"></h6>
                <p><strong>IP:</strong> <span id="detail-server-ip"></span></p>
                <p><strong>Porta:</strong> <span id="detail-server-port"></span></p>
                <p><strong>Status:</strong> <span id="detail-server-status" class="text-success fw-bold">Online</span></p>
                <p><strong>Carga:</strong> <span id="detail-server-load">25%</span></p>
            </div>

        </div>
      </div>
    </div>
  </div>

  <nav class="navbar fixed-bottom navbar-light bg-light">
    <div class="container justify-content-center">
      <a class="nav-link text-dark mx-3" href="#"><strong>Início</strong></a>
      <a class="nav-link text-dark mx-3" href="index.html"><strong>Índice</strong></a>
      <a class="nav-link text-dark mx-3" href="support.html"><strong>Suporte</strong></a>
      <a class="nav-link text-dark mx-3" href="about.html"><strong>Sobre</strong></a>
      <a class="nav-link text-dark mx-3" href="servers.html"><strong>Servidores</strong></a>
    </div>
  </nav>

  <!-- ============================================== -->
  <!-- MODAIS (Sem Alterações) -->
  <!-- ============================================== -->
  <!-- MODAL: Atualizar Atributos (Frontend Only) -->
  <div class="modal fade" id="updateAttributesModal" tabindex="-1" aria-labelledby="updateAttributesModalLabel" aria-hidden="true">
    <div class="modal-dialog">
      <div class="modal-content">
        <div class="modal-header bg-secondary text-white">
          <h5 class="modal-title" id="updateAttributesModalLabel">Atualizar Atributos do Perfil</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          <p class="text-dark">Preencha apenas os campos que deseja alterar. Os campos vazios serão ignorados.</p>
          <form id="updateAttributesForm">
            <div class="mb-3">
              <label for="update-name" class="form-label">Nome</label>
              <input type="text" class="form-control" id="update-name" placeholder="Nome completo (opcional)">
            </div>
            <div class="mb-3">
              <label for="update-email" class="form-label">Email</label>
              <input type="email" class="form-control" id="update-email" placeholder="Novo email (opcional)">
            </div>
            <div class="mb-3">
              <label for="update-state" class="form-label">Estado</label>
              <input type="text" class="form-control" id="update-state" placeholder="Estado (opcional)">
            </div>
            <div class="mb-3">
              <label for="update-phone" class="form-label">Telefone</label>
              <input type="text" class="form-control" id="update-phone" placeholder="Telefone (opcional)">
            </div>
            <div class="mb-3">
              <label for="update-institution" class="form-label">Instituição</label>
              <input type="text" class="form-control" id="update-institution" placeholder="Instituição (opcional)">
            </div>
            <hr class="my-4">
            <h6 class="text-primary">Atualização de Senha</h6>
            <div class="mb-3">
              <label for="update-newPassword" class="form-label">Nova Senha</label>
              <input type="password" class="form-control" id="update-newPassword" placeholder="Preencha para alterar a senha (mín. 8 caracteres)">
            </div>
            <div class="mb-3">
              <label for="update-confirmPassword" class="form-label">Confirmar Nova Senha</label>
              <input type="password" class="form-control" id="update-confirmPassword" placeholder="Confirme a nova senha">
            </div>
          </form>
          <div id="updateMessage" class="mt-3 text-center text-primary fw-bold" style="display: none;"></div>
        </div>
        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
          <button type="button" class="btn btn-primary fw-bold" onclick="updateAttributes()">Atualizar Atributos</button>
        </div>
      </div>
    </div>
  </div>

  <!-- MODAL: Gerenciar Servidores (Frontend Only) -->
  <div class="modal fade" id="manageServersModal" tabindex="-1" aria-labelledby="manageServersModalLabel" aria-hidden="true">
    <div class="modal-dialog modal-lg">
      <div class="modal-content">
        <div class="modal-header bg-primary text-white">
          <h5 class="modal-title" id="manageServersModalLabel">Gerenciar Servidores</h5>
          <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal" aria-label="Fechar"></button>
        </div>
        <div class="modal-body">
          
          <h6 class="text-primary mb-3">Adicionar Novo Servidor</h6>
          <form class="row g-3 mb-4" onsubmit="addServer(event)">
            <div class="col-md-5">
              <input type="text" class="form-control" id="newServerIp" placeholder="Endereço IP (e.g., 192.168.1.1)" required>
            </div>
            <div class="col-md-4">
              <input type="number" class="form-control" id="newServerPort" placeholder="Porta (e.g., 30120)" required>
            </div>
            <div class="col-md-3">
              <button type="submit" class="btn btn-primary w-100">Adicionar Servidor</button>
            </div>
            <div class="col-12" id="addServerMessage" style="display: none;"></div>
          </form>

          <hr>

          <h6 class="text-primary mb-3">Servidores Atuais (<span id="serverCount">0</span>)</h6>
          <div class="list-group" id="modalServerList">
            <!-- Servidores serão listados aqui -->
          </div>

          <!-- NOVO LINK PARA DOCUMENTAÇÃO AVANÇADA -->
          <div class="mt-4 pt-3 border-top text-center">
            <p class="small text-muted mb-2">Deseja alterar especificações detalhadas (CPU, RAM, Disco)?</p>
            <a href="servers.html" class="btn btn-outline-primary btn-sm">
              <i class="fas fa-server me-2"></i>Acessar Configurações Avançadas de Servidores
            </a>
          </div>
        </div>

        <div class="modal-footer">
          <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Fechar</button>
        </div>
      </div>
    </div>
  </div>

  <!-- Scripts Bootstrap 5 e Lógica Frontend -->
  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  <script type="module">
    import { homepage } from '../js/homepage.js'; 
    homepage(); 
  </script>
</body>
</html>